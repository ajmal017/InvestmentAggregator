<!DOCTYPE html>
<html lang="en">
<style>
.text-muted {
        color: #777;
}

/* Sticky footer styles
   -------------------------------------------------- */
html {
      position: relative;
            min-height: 100%;
}
body {
      /* Margin bottom by footer height */
      margin-bottom: 60px;
      padding-top: 60px;
}
.footer {
      position: absolute;
            bottom: 0;
                  //width: 100%;
                    /* Set the fixed height of the footer here */
                    height: 60px;
}


/* Custom page CSS
   -------------------------------------------------- */
/* Not required for template or sticky footer method. */

body > .container {
//      padding: 60px 15px 0;
}
.container .text-muted {
      margin: 20px 0;
}

.footer > .container {
      padding-right: 15px;
            padding-left: 15px;
}

code {
      font-size: 80%;
}

.main_icon {
    height: 50px;
    width: 50px;
}

.scroll-box {
    //background: #474749;
    background: #222;
    border: 4px solid rgba(0, 0, 0, 0.1);
    height: 100%; /* maximum height of the box, feel free to change this! */
    width: 17%;
    overflow-y: auto;
    right: 0;
    top: 51px;
    position:fixed;
    padding-left: 1%;
    padding-right: 1%;
}

.robinhood-logo
{
    width: 300px;
    position: absolute;
    left: 50%;
    margin-left: -150px;
    border-radius: 10px;
}


</style>
<script>
/* ------------------------------------------------------------------------- */
/* Developer: Andrew Kirfman                                                 */
/* Project: InvestmentAggregator                                             */
/*                                                                           */
/* File: ./main_screen.js                                                    */
/* ------------------------------------------------------------------------- */

var widget_height = 790;


/* ------------------------------------------------------------------------- */
/* Code to Execute on Page Load                                              */
/* ------------------------------------------------------------------------- */

function addLoadEvent(func) {
    var oldonload = window.onload;

    if(typeof window.onload != 'function')
    {
        window.onload = func;
    }
    else
    {
        window.onload = function()
        {
            if(oldonload)
            {
                oldonload();
            }

            func();
        };
    }
}

function update_footer_date()
{
    date = new Date().getFullYear();
    document.getElementById('footer-text').innerHTML = "&copy; "
        + date + ": Andrew Kirfman & Cuong Do";
};

addLoadEvent(update_footer_date);


/* ------------------------------------------------------------------------- */
/* Initial Variable Declarations                                             */
/* ------------------------------------------------------------------------- */

var host_parser = document.createElement('a');
host_parser.href = window.location.href;
var host_addr = host_parser.host;

/* ------------------------------------------------------------------------- */
/* Websocket Communication                                                   */
/* ------------------------------------------------------------------------- */

var socket_addr = "ws://" + host_addr + "/ws_robinhood_login";
var ws = new WebSocket(socket_addr);

ws.onopen = function()
{  
    ws.send("CheckRobinhoodLogin")
};

ws.onmessage = function(received_message)
{
    var message_text = received_message.data.trim();

    // If the ticker was valid, move the site a new page
    if(message_text.indexOf("ValidationSucceeded") >= 0)
    {
        var fields = message_text.split(":");
        var ticker = fields[1];

        window.location.href = "/ticker?" + String(ticker);
    }
    // If it was not valid, tell the user and stay here
    else if(message_text.indexOf("ValidationFailed") >= 0)
    {
        // Indicate that the search failed

    }
    else if(message_text.indexOf("LoginSucceeded") >= 0)
    {
        window.location.href = "/";
    }
    else if(message_text.indexOf("LoginFailed") >= 0)
    {
        var username_box = document.getElementById("username-box");
        var password_box = document.getElementById("password-box");
        
        username_box.className = username_box.className.replace("has-error", "");
        password_box.className = password_box.className.replace("has-error", "");
        
        username_box.className = username_box.className + " has-error";
        password_box.className = username_box.className + " has-error";
        
        var username = document.getElementById("username");
        var password = document.getElementById("password");
        
        username.value = "";
        password.value = "";
    }
    else if(message_text.indexOf("RobinhoodLoggedIn") >= 0)
    {
        var fields = message_text.split(":");
        var username = fields[1];
    
        robinhood_container = document.getElementById("robinhood-container");
        
        robinhood_container.innerHTML = '<li><a href="/robinhood_login" '
            + 'style="color:#20CE99;">Logged into Robinhood as: ' + String(username) 
            + '</a></li>';

        // Since we're already logged in, change this screen to show the user's 
        // account features.  This requires wiping over the entire main container
        
        // Figure out how to do this more eloquently...  
        // As it stands right now, the login screen is being flashed to users...
        
        main_container = document.getElementById("main-container");
        
        while(main_container.firstChild)
        {
            main_container.removeChild(main_container.firstChild);
        }

    }
};


ws.onclose = function()
{  };

/* ------------------------------------------------------------------------- */
/* Go To Ticker                                                              */
/* ------------------------------------------------------------------------- */

function GoToTicker()
{
	var ticker_name = document.getElementById("ticker-text").value.trim().toUpperCase()
	
	ws.send("ValidateTicker:" + String(ticker_name));
}

function Login()
{
    var username_box = document.getElementById("username");
    var password_box = document.getElementById("password");
    
    var username = username_box.value.trim();
    var password = password_box.value.trim();
    
    ws.send("Login:" + String(username) + ":" + String(password))
}

</script>
<head>
    <title>InvestmentAggregator: Home</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<script>
// Enable popovers across the whole document
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>
<body class="body" style="background: #2a2c39 !important">
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<!-- I want to add in a website logo later on -->
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="/" style="color:#ffffff">InvestmentAggregator</a>
			</div>
			
			<ul class="nav navbar-nav">
				<li><a href="/investing_tips" style="color:#ffffff">Investing Basics</a></li>
				<li><a href="/investing_strategies" style="color:#ffffff">Simple Strategies</a></li>
			</ul>
			<form class="navbar-form navbar-left" onsubmit="return false;">
				<div class="input-group">
					<input type="text" class="form-control" 
						placeholder="Stock Ticker" id="ticker-text">
					<div class="input-group-btn">
						<button class="btn btn-default" type="button" onclick="GoToTicker()">
							<i class="glyphicon glyphicon-search"></i>
						</button>
					</div>
				</div>
			</form>
            
            <ul class="nav navbar-nav navbar-right" id="robinhood-container">
                <li><a href="/robinhood_login" style="color:#20CE99;">Login to Robinhood</a></li>
            </ul>
			
		</div>
	</nav>
    <div class="container-fluid" id="main-container">
        <div class="row">
            <h1 class="text-center" style="color:#20CE99;display:none;">Log Into Robinhood!</h1>
        </div>
        
        <div class="row">
            <div class="col-md-4"></div>
            
            <div class="col-md-4">
                <h4 class="text-center" style="color:#FFFFFF;">
                Logging in will allow you to view your existing positions along with opening/closing new ones.  
                </h4>
            </div>
            
            <div class="col-md-4"></div>
        </div>
        
        <div class="row" style="padding-top:25px;">
        </div>
        
        <div class="row">
            <img src="/static/pictures/Robinhood_Logo.png" class="robinhood-logo">
        </div>
        
        <div class="row" style="padding-top:310px;">
            <div class="col-md-4"></div>
            
            <div class="col-md-4">
                <div class="form-group" id="username-box">
                    <label for="username" style="color:#20CE99;">Username:</label>
                    <input type="text" class="form-control" id="username">
                </div>
            </div>
            
            <div class="col-md-4"></div>
        </div>
        
        <div class="row">
            <div class="col-md-4"></div>
            
            <div class="col-md-4">
                <div class="form-group" id="password-box">
                    <label for="password" style="color:#20CE99;">Password:</label>
                    <input type="password" class="form-control" id="password">
                </div>
            </div>
            
            <div class="col-md-4"></div>
        </div>        

        <div class="row">
            <div class="col-md-4"></div>
        
            <div class="col-md-4">
                <button type="button" class="btn btn-default" onclick="Login()">Login</button>
                <button type="button" class="btn btn-danger" onclick='window.location.href="/"'>Cancel</button>
            </div>
        
            <div class="col-md-4"></div>
        </div>



    </div>




    <footer class="footer">
        <div class="container">
            <p id="footer-text" class="text-muted"></p>
        </div>
    </footer>


</body>
</html>

